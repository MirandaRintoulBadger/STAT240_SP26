---
title: "live_dplyr_week3"
author: "Sahifa"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, error = TRUE)
library(tidyverse)
install.packages("magrittr")
library(magrittr)
```
# Monday

```{r}
# nesting

log(sqrt(3*5^2+4))

(3*5^2+4) %>% sqrt() %>% log()
```

- pipe operator

MAC: cmd+opt+m
windows: ctrl + shift + m

%>%

```{r}
(3*5^2+4)

add(multiply_by(raise_to_power(5, 2), 3), 4)

5 %>% raise_to_power(2) %>% multiply_by(3) %>% add(4)
```

```{r}
grocery_prices = read_csv("../data/grocery-prices.csv")
grocery_list = read_csv("../data/grocery-list.csv")
```
# Wednesday

```{r}
1 %>% add(2)
add(1,2)
add(2,1)
```


# function sthat deal with Columns:

- mutate() : adding columns to your dataset

```{r}
grocery_prices

grocery_prices %>% mutate(price_after_tax = price*0.02, total_cost = price_after_tax+price)
```


- select(): this function will only keep the columns specified in the output


```{r}
grocery_prices %>% mutate(price_after_tax = price*0.02, total_cost = price_after_tax+price) %>% 
  select(item, type, total_cost)


grocery_prices %>% mutate(price_after_tax = price*0.02, total_cost = price_after_tax+price) %>% 
  select(- price, - price_after_tax)

grocery_prices %>% mutate(price_after_tax = price*0.02, total_cost = price_after_tax+price) %>% 
  select(- c(price, price_after_tax))

grocery_prices %>% mutate(price_after_tax = price*0.02, total_cost = price_after_tax+price) %>% 
  select(-c(price:price_after_tax))
```

- relocate(): this function relocates the column specified either to the first position or it'll move it with resoect to other columns

```{r}
grocery_prices %>% 
  mutate(price_after_tax = price*0.02, total_cost = price_after_tax+price) %>% 
  relocate(item, type, total_cost)

grocery_prices %>% 
  mutate(price_after_tax = price*0.02, total_cost = price_after_tax+price) %>% 
  relocate(price, .after = total_cost)


grocery_prices %>% 
  mutate(price_after_tax = price*0.02, total_cost = price_after_tax+price) %>% 
  relocate(price, .before = price_after_tax)

grocery_prices %>% 
  mutate(price_after_tax = price*0.02, total_cost = price_after_tax+price) %>% 
  relocate(c(price_after_tax, total_cost), .after = price)
```

- rename(): this function renames columns, format is similar to mutate, new_col_name = old_col_name

```{r}
grocery_new = grocery_prices %>% 
  mutate(price_after_tax = price*0.02, total_cost = price_after_tax+price) %>% 
  rename(tax = price_after_tax)
```

- Row operations

- arrange(): this function arranges the rows with respect to a column

```{r}
grocery_new %>% arrange(total_cost) # increasing order or ascending

grocery_new %>% arrange(item)

grocery_new %>% arrange(- total_cost) # decreasing or descending order

grocery_new %>% arrange(desc(total_cost)) # decreasing or descending order
```

- filter(): this function filters out or draws rows that satify the condition on a specific column.

```{r}
grocery_new %>% filter(price>= 1) %>% arrange(price)

grocery_new %>% filter(!is.na(price) | !is.na(type))
```

```{r}
starwars %>% filter(!is.na(hair_color) & !is.na(birth_year))
```

- slice_max and slice_min: these functions will filter out the n numbers rows that have max or mino fthe specified col

```{r}
grocery_new %>% slice_max(total_cost, n = 3)
```

# Operations on groups

- summarize(): is for summary tables ()

```{r}
grocery_new %>% summarise(avg_cost = mean(total_cost), sd_cost = sd(total_cost), median_price = median(price), count = n())
```
# Friday

- group_by(): this function creates groups and the next function in the line of code will only act on those groups.

```{r}
grocery_new %>% group_by(type)

grocery_new %>% group_by(price > 1)
```

```{r}
grocery_new %>% group_by(type) %>% summarise(avg_price = mean(price), most_expensive = max(price))
```


```{r}
grocery_new %>% group_by(type) %>% slice_max(price, n = 2)
```


```{r}
grocery_new %>% group_by(type) %>% mutate(avg = mean(price)) %>% relocate(avg, .after = type)
```

```{r}
grocery_new %>% group_by(type, price>1) %>% summarise(avg = mean(price))

grocery_new %>% group_by(price>1, type) %>% summarise(avg = mean(price))
```

- n(): this gives you the number of rows in that column or group. Usually used inside summarize

```{r}
grocery_new %>% group_by(price>1) %>% summarise(avg = mean(price), n = n())
```

- count(): does the same thing as n(), without summarize()

```{r}
grocery_new %>% group_by(type) %>% summarise(n = n())

grocery_new %>% count(type)
```

- case_when(): thsi function is used to create customized groups. Usually used inside mutate

```{r}
student_age = tibble(
  name = c("A", "B", "C", "D", "E", "F"),
  age = 17:22
) %>% 
  slice_sample(n = 6)

student_age
```

can't vote age < 18
can drink age >= 21
can vote but can't drink 18 <= age < 21

```{r}
student_age %>% mutate(legal_Status = case_when(
  age < 18 ~ "Can't vote",
  age >=18 & age < 21 ~ "Can't drink but can vote",
  age >= 21 ~ "Can drink and vote"
))
```

```{r}
student_grade = tibble(
  grade = runif(100,30, 100),
) %>% 
  slice_sample(n = 10)
student_grade
```
 A grade 90 - 100
 B grade 80 - 90
 C grade 70 - 80
 D grade 60 - 70
 E grade 50 - 60
 F grade < 50

Letter_grade

```{r}
student_grade %>% mutate(Letter_grade = case_when(
  grade >= 90 ~ "A",
  grade >= 80 & grade < 90 ~ "B"
  .
  .
  .
  grade < 50 ~ "F"
))
```


# Operations on pair of dataset

## Joining

## Mutating joins: 

- `left_join()`

grocery_list as dataset A
grocery_prices as dataset B

```{r}
left_join(grocery_list, grocery_prices)

left_join(grocery_list, grocery_prices, by = join_by(item))
```

- right_join():

```{r}
right_join(grocery_list, grocery_prices)

# get the similar output as left_join with the rows of grocery list using right_join

right_join(grocery_prices, grocery_list)
```





















