---
title: "Homework 2"
author: "Solutions"
output: html_document
---

```{css, echo = F}
.rsoln {
background-color: #E6E6FA;
}

.soln {
color: #5858d0;
}
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message=FALSE, error = TRUE)
library(tidyverse)
```

```{r, echo=F}
old <- theme_get()

theme_set(theme(panel.background = element_rect(fill = "#ededfb")))
```

# Preliminaries

- This file should be in `STAT240/homework/hw02` on your local computer.
- You should also download `lake-monona-winters-2025.csv` and `lake-mendota-winters-2025.csv` to `STAT240/data` on your local computer.

While you should create your answers in the .Rmd file, homework problems are better formatted and therefore easier to read in the .html file. We recommended frequently knitting and switching between the two as you read and solve problems.

The dataset `lake-monona-winters-2025.csv` records the first freeze, last thaw, and duration of ice cover on Lake Monona for each winter.  We are primarily interested in the following variables:

- `ff_cat`, the categorical variable describing the period of the day of the first freeze
- `year1`, the starting year of that winter
- `duration`, the duration of ice cover in days

```{r read-data, echo = FALSE}
monona <- read_csv("../../data/lake-monona-winters-2025.csv")
```

# Problem 1

Create a histogram of the `duration` of Lake Monona's closures due to ice using the `monona` dataframe created above. Incorporate the following customizations:

- Bars should span neat intervals of ten; [40, 50], [50, 60], and so on. Make sure they start and end on multiples of 10.

- Change the outline and inside color of the bars to some custom combination that you think looks good together.

```{r, class.source="rsoln", class.output="rsoln"}
# We could've set "boundary" to any multiple of 10
# Alternatively, we could've set "center" to any number ending in 5

ggplot(monona, aes(x=duration)) +
  geom_histogram(boundary = 0, binwidth = 10,
                 color = "navy", fill = "skyblue")
```


# Problem 2

Your friend is trying to produce this plot of frequency counts for the variable `ff_cat`, which captures the date of first freeze in two week periods.

See the file `exampleBarplot.png` in the hw02 folder on Github.

Your friend's attempt below is producing an error.

```{r, error = TRUE}
# Fix your friend's error!
ggplot(monona, aes(x = ff_cat)) +
  geom_col()
```

Fix your friend's error by editing the above chunk (or create another one). Then, explain why the original code was wrong and why the fixed code works.

For this problem, you just need to create a working bar plot.  For an extra challenge, try to figure out how to change the order of the bars.

```{r, class.source="rsoln", class.output="rsoln"}
# Fixed code
ggplot(monona, aes(x = ff_cat)) +
  geom_bar()
```

[`geom_col()` requires two aesthetics, x and y; for when you want to customize the heights of the bars according to some second variable. geom_bar is a shortcut for counting the number of occurrences of a variable and therefore only requires one aesthetic (the other is computed automatically).]{.soln}


# Problem 3

Code in the next chunk makes a scatter plot that shows how the variable `duration` changes with time (using `year1`).

```{r}
# This chunk is provided for you - do not edit
ggplot(monona, aes(x = year1, y = duration)) +
  geom_point(alpha = 0.2) +
  geom_smooth(method = "lm", se=FALSE) +
  labs(
    title = "Lake Monona Winter Closure Durations Over Time",
    subtitle = "Trend Line Shown in Blue"
  )
```

(a) What does the argument `method = "lm"` change on the plot?

[`method = "lm"` forces the best-fit blue line to be straight. Leaving this argument out allows it to curve as it desires.]{.soln}

(b) What does the argument `se = FALSE` change on the plot?

[By default, `geom_smooth()` includes a gray ribbon of statistical confidence around it. `se = FALSE` turns this ribbon off.]{.soln}


# Problem 4

This problem refers to the graph created in problem 3 above. Its goal is to display to the viewer that, on average, the duration Lake Monona closes due to ice is decreasing over time.

(a) In a typical year around 1875, how long would Lake Monona close due to ice? (No code needed - your best guess based on the plot will suffice.) 

[Roughly 115 days; height of blue line at x = 1875.]{.soln}

(b) In a typical year around 2000, how long would Lake Monona close due to ice?

[Roughly 90 days; height of blue line at x = 2000.]{.soln}

(c) Consider encountering this graph in a published news paper. Name one specific thing this graph does well to accomplish its goal, and what specific part of the code is responsible for it.

[Example answers: Points are "faded" into background by `alpha = 0.2`, main title and subtitle specified via `labs()`.]{.soln}

(d) In the same context as c), name one specific thing that could be improved about this graph, and describe what code you would add/edit to make it happen. (No need to formally write and run the code, just a description.)

[Example answers: Axis titles could be improved with `labs()`, tick labeling could be improved by `scale_*_continuous()`, theme could be changed by `theme_bw()` or `theme_minimal()`, etc.]{.soln}


# Problem 5

The below chunk (which is hidden in the knitted file) reads in `lake-mendota-winters-2025.csv` into a new object called `mendota`.  This dataframe records the same winter freeze variables for Lake Mendota, just like the `monona` data does for Lake Monona.

```{r, echo = FALSE, message = FALSE, warning = FALSE}
mendota <- read_csv("../../data/lake-mendota-winters-2025.csv")
```

The code below uses both datasets to create a single plot of year vs duration for both lakes.  

```{r, echo = F}
theme_set(old)
```


```{r}
ggplot(mapping = aes(x = year1, y = duration)) +
  geom_smooth(data = mendota, color = "red") +
  geom_smooth(data = monona, color = "blue")
```

```{r, echo=F}
old <- theme_get()

theme_set(theme(panel.background = element_rect(fill = "#ededfb")))
```


Identify all of the aesthetics used in this plot, and explain whether each one is constant or variable.  Are the variable aesthetic(s) global or local?

[The x and y are both variable aesthetics mapped to the year and duration respectively from the data.  They are both global, since they are in the top-most `ggplot()` call.  So, both of the subsequent `geom_smooth()` lines will inherit that specific x and y mapping.  Color is a local aesthetic used within each of the `geom_smooth()` calls to color each line separately.]{.soln}


# Problem 6

The below chunk creates a new dataframe called `combined`, which contains freeze durations for both Lake Mendota AND Lake Monona.

```{r}
# We will learn how this code works next week!
combined = bind_rows(monona %>% mutate(lake = "Monona"), mendota %>% mutate(lake = "Mendota")) %>% 
  arrange(desc(year1)) %>% 
  select(lake, year1, duration)

# Take a look at the first six rows; notice we have TWO rows for each year now, one for each lake!
head(combined)
```

Create a similar plot to problem 5, with `duration` on the y axis, `year1` on the x axis, and two smooth lines, one for each lake. This time, use the `combined` dataset and a single call to `geom_smooth()`.

```{r, class.source="rsoln", class.output="rsoln"}
ggplot(combined, aes(year1, duration)) +
  geom_smooth(aes(color = lake))
```


# Problem 7

Using the `combined` data, create a plot similar to problems 5 and 6, but with a line showing each year's specific data point, rather than a smooth line.  There should be two separate lines for each lake.

```{r, class.source="rsoln", class.output="rsoln"}
ggplot(combined, aes(year1, duration)) +
  geom_line(aes(color = lake))
```

# Problem 8

Compare the graphs from problems 6 and 7.

Consider trying to determine in what time period Lake Mendota was freezing, on average, longer than Lake Monona. Which of graph do you prefer for this determination and why?

[The smooth graph from problem 6 is much easier to use to answer this problem, even though the graph from problem 7 gives more specific information.  Because the freeze times (which vary a lot by chance) are smoothed over, it is much easier to distinguish larger patterns over time.]{.soln}

